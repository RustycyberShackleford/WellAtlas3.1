{% extends "base.html" %}
{% block content %}

<h1 style="color:#f3e7b3; margin-bottom:10px;">
    {{ site.site_name }}
</h1>

<!-- MINI MAP -->
<div id="miniMap" class="mini-map"></div>

<script>
    var miniMap = L.map('miniMap', { zoomControl: false, attributionControl: false })
        .setView([{{ site.lat }}, {{ site.lng }}], 15);

    L.tileLayer(`https://api.maptiler.com/maps/hybrid/256/{z}/{x}/{y}.jpg?key={{ maptiler_key }}`, {
        tileSize: 256,
        maxZoom: 18
    }).addTo(miniMap);

    L.marker([{{ site.lat }}, {{ site.lng }}]).addTo(miniMap);
</script>

<!-- SITE INFORMATION -->
<div class="content-box">
    <h2 style="color:#d4af37;">Site Information</h2>

    <p><strong>Address:</strong> {{ site.street }} {{ site.city }}, {{ site.state }} {{ site.zip }}</p>
    <p><strong>Contact:</strong> {{ site.contact_name }}</p>
    <p><strong>Phone:</strong> {{ site.phone }}</p>
    <p><strong>Email:</strong> {{ site.email }}</p>

    {% if site.notes %}
    <p><strong>Notes:</strong><br>{{ site.notes }}</p>
    {% endif %}

    <a class="btn" href="{{ url_for('edit_site', site_id=site.id) }}">
        Edit Site
    </a>
    <a class="btn" href="{{ url_for('add_job_with_site', site_id=site.id) }}">
        Add Job
    </a>
</div>


<!-- JOB LIST -->
<div class="content-box">
    <h2 style="color:#d4af37;">Jobs at This Site</h2>

    {% if jobs|length == 0 %}
        <p>No jobs added yet.</p>
    {% else %}

    {% for job in jobs %}
        <div class="job-item {% if job.is_overdue %}overdue{% endif %}">
            
            <!-- Job Title Link -->
            <a class="data-link" href="{{ url_for('job_detail', job_id=job.id) }}">
                {{ job.job_number }} â€“ {{ job.title }}
            </a>

            <br>

            <!-- Division Badge -->
            {% if job.division == 'Domestic' %}
                <span class="div-badge div-domestic">Domestic</span>
            {% elif job.division == 'Ag' %}
                <span class="div-badge div-ag">Ag</span>
            {% elif job.division == 'Drilling' %}
                <span class="div-badge div-drilling">Drilling</span>
            {% elif job.division == 'Electrical' %}
                <span class="div-badge div-electrical">Electrical</span>
            {% endif %}

            <!-- Status Tag -->
            <span class="status-tag {{ job.status|lower }}">
                {{ job.status }}
            </span>

            <br><br>

            <!-- Dates -->
            <p>
                <strong>Start:</strong> {{ job.start_date }}<br>
                <strong>End:</strong> {{ job.end_date }}<br>
                <strong>Duration:</strong> {{ job.duration }} days
            </p>

        </div>
    {% endfor %}

    {% endif %}
</div>

{% endblock %}
