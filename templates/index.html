{% extends "base.html" %}
{% block content %}

<h1 class="page-title">WellAtlas V4 (Gold Model)</h1>

<div class="nav-row">
    <a href="{{ url_for('home') }}" class="nav-button">Home</a>
    <a href="{{ url_for('customers') }}" class="nav-button">Customers</a>
    <a href="{{ url_for('calendar_view') }}" class="nav-button">Calendar</a>
    <a href="{{ url_for('map_view') }}" class="nav-button">Field Map</a>
</div>

<p class="subtitle">
    Scheduling & Field Ops · Demo Dataset<br>
    Willows → Cottonwood Corridor
</p>

<div class="layout">
    <!-- LEFT SIDE: TODAY'S JOBS -->
    <div class="jobs-panel">
        <h2>Today's Jobs (Demo)</h2>

        {% if customers | length == 0 %}
            <p>No demo jobs scheduled for today.</p>
        {% else %}
            <ul class="job-list">
                {% for c in customers %}
                    <li>
                        <strong>{{ c.name }}</strong><br>
                        <span>{{ c.city }}, {{ c.state }}</span>
                    </li>
                {% endfor %}
            </ul>
        {% endif %}
    </div>

    <!-- RIGHT SIDE: INTERACTIVE MAP -->
    <div class="map-panel">
        <div id="map"></div>
    </div>
</div>

<!-- MAP SCRIPT -->
<script>
    // Default center of the Northstate corridor
    const map = L.map('map').setView([40.3, -122.2], 8);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
    }).addTo(map);

    const pins = {{ pins | tojson }};

    pins.forEach(p => {
        L.marker([p.lat, p.lng])
            .addTo(map)
            .bindPopup(`<b>${p.site_name}</b><br>ID: ${p.id}`);
    });
</script>

{% endblock %}
